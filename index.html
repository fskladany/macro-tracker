<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Macro Tracker</title>

	<link rel="stylesheet" href="ui-construction.css">
	<link rel="stylesheet" href="ui-window.css">
	<link rel="stylesheet" href="recipe.css">

	<style>
		body {
			font-family: 'Arial', sans-serif;
			background-color: #f7f7f7;
			margin: 0;
			padding: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			overflow: hidden;
			background-color: #ccc;
			/* Prevent scrolling */
		}

		.main-container {
			position: relative;
			width: 100%;
			max-width: 1200px;
		}


		input,
		button,
		textarea,
		select {
			width: 100%;
			padding: 10px;
			margin: 10px 0;
			border-radius: 5px;
			border: 2px solid #ddd3;
			background-color: #CCC;
			box-sizing: border-box;
			font-size: 20px;
		}

		button {
			background-color: rgb(255 216 144 / 84%);
			color: white;
			cursor: pointer;
		}

		button.subtle {
			background-color: rgb(229 226 150 / 33%);
			color: rgb(82, 79, 79);

			cursor: pointer;
			margin: auto;
			width: 31%;
			margin-left: 1%;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
		}

		th,
		td {
			text-align: left;
			padding: 8px;
			border-bottom: 1px solid #a0a18480;
		}

		th {
			background-color: #cccfb857;
		}

		.totals,
		.totals24 {
			margin-top: 15px;
		}

		.total-item {
			margin-bottom: 10px;
		}



		.goal-reached {
			background-color: rgb(255, 0, 0);
			color: white;
		}

		.halfway-there {
			background-color: rgb(255, 238, 0);
		}

		.totals div,
		.totals24 div {
			font-size: 26px;
		}
	</style>
	<script src="restrainings.js"></script>
	<script src="recipe.js"></script>
	<script src="ingredients.js"></script>
	<script src="macro-distribution.js"></script>
	<script src="fluency.js"></script>
	<script src="relation.js"></script>
	<script src="keyboards.js"></script>

	<script>

		function toggleWindow(windowId) {
			const windowEl = document.getElementById(windowId);
			if (windowEl) {
				windowEl.classList.toggle('hidden');
			}
		};

		// Call this function on page load to populate the select dropdown
		document.addEventListener('DOMContentLoaded', function () {
			// Alternatively (not verified) document.queryFirst('#templateSelector.addEventListner () => {
			//    LoadTemplateItems(self.id)
		    //})
			window.MacroTracker.LoadFoodItemTemplates('templateSelect');
			window.MacroTracker.LoadFoodItemTemplates('shoppingPurposeKey');
			
			// Initial table and totals update
			window.MacroTracker.displayHistoryTable();
			window.MacroTracker.updateDailyTotals();

			window.MacroTracker.DisplayDailyTotals();
			window.KeyboardPermission.SetKeyboardEvents();


			// Activate the drag function for the draggable elements

			window.UiNode.dragElement(document.getElementById("historyWindowParent"));
			window.UiNode.dragElement(document.getElementById("addEntryWindow"));
			window.UiNode.dragElement(document.getElementById("sumDigestionWindow"));
			window.UiNode.dragElement(document.getElementById("dayListOverviewParent"));
			window.UiNode.dragElement(document.getElementById("costlyWillWindow"));
			window.UiNode.dragElement(document.getElementById("timeWindow"));
			window.UiNode.dragElement(document.getElementById("recipeWindow"));
			window.UiNode.dragElement(document.getElementById("shoppingWindow"));
			window.UiNode.dragElement(document.getElementById("recipeCreatorWindow"));
			window.UiNode.dragElement(document.getElementById("startMenu"));
			window.UiNode.dragElement(document.getElementById("inventoryWindow"));
			window.UiNode.dragElement(document.getElementById("vacuumWindow"));
			window.UiNode.dragElement(document.getElementById("fridgeWindow"));
            window.UiNode.dragElement(document.getElementById("intentionsWindow"));
            window.UiNode.dragElement(document.getElementById("actionHistoryWindow"));

			loadFlows();



		});


	</script>
</head>

<body>

	<div id="startMenu" class="draggable">
        <button id="startMenuToggle" onclick="document.getElementById('startMenuList').classList.toggle('hidden')">(m)</button>
        <div id="startMenuList" class="draggable hidden">
			<div class="menu-item-group">
                <button onclick="toggleWindow('addEntryWindow')">Macro Tracker â–¸</button>
                <div class="submenu">
                    <button onclick="toggleWindow('historyWindowParent')">History</button>
                    <button onclick="toggleWindow('sumDigestionWindow')">Totals</button>
                    <button onclick="toggleWindow('dayListOverviewParent')">Day Overview</button>
                </div>
            </div>
            <button onclick="toggleWindow('recipeWindow')">My Recipes</button>
			<button onclick="toggleWindow('inventoryWindow')">Local storage</button>
            <button onclick="toggleWindow('recipeCreatorWindow')">Recipe Creator</button>
            <button onclick="toggleWindow('shoppingWindow')">Shopping</button>
			<button onclick="toggleWindow('intentionsWindow')">Intentions</button>
            <button onclick="toggleWindow('actionHistoryWindow')">Action History</button>
			<div class="menu-item-group">
                <button>External â–¸</button>
                <div class="submenu">
					<button onclick="toggleWindow('costlyWillWindow')">Willpower</button>
					<button onclick="toggleWindow('timeWindow')">Time</button>
					<button onclick="toggleWindow('vacuumWindow')">Vacuum</button>
					<button onclick="toggleWindow('fridgeWindow')">Fridge</button>
					<button style="background-color: #777">16 Mhz crystal</button>
                </div>
            </div>
        </div>
    </div>

	<div id="addEntryWindow" class="draggable container ui-window" style="z-index: 100;">
		<div class="anchor-group anchor-up" style="float: right">
			<div class="anchor" data-id="win-add" > ðŸ“€ </div>
			<div class="anchor" data-id="win-add-up"> ðŸ’¿ </div>
		</div>
		<h1 style="margin-bottom:20px">Macro Tracker</h1>


		<label for="templateSelect" style="float: left">Choose an ingredient variant:</label>
		<label style="float: right;" for="multiplier">Amount:</label>
		<select id="templateSelect" style="float: left;width:70%; left:0;"
			onchange="window.MacroTracker.handleFoodItemSelection()">
			<option value="">Manual template...</option>
		</select>

		<input style="float: right; width:23%" type="number" id="multiplier" placeholder="1=100g" step="0.5"
			onchange="window.MacroTracker.handleFoodItemSelection(true)" value="0.5">
		<div id="macro-actions-row">
			<button style="width:23%" onclick="window.MacroTracker.AddEntry()"> Eat Raw </button>
			<button style="width:33%" onclick="alert('ingredient');"> Save As... </button>
			<button style="float: right; width:33%" onclick="document.querySelector('#recipeWindow').classList.remove('hidden')"> + Find Recipe </button>
		</div>

		<label for="fat">Fat (g)</label>
		<input type="number" id="fat" placeholder="Fat (g)" value="0">

		<label for="carbs">Carbs (g)</label>
		<input type="number" id="carbs" placeholder="Carbs (g)" value="0">

		<label for="protein">Protein (g)</label>
		<input type="number" id="protein" placeholder="Protein (g)" value="0">

		<label for="comment">Comment</label>
		<textarea id="comment" placeholder="Describe food nuance..."></textarea>

		<button class="subtle" onclick="window.MacroTracker.pasteEntries()">Load ...</button>
		<button class="subtle" onclick="window.MacroTracker.getEntriesJSON()">Get entries</button>
		<button class="subtle" onclick="window.MacroTracker.UndoLastEntry()">Undo Add</button>


	</div>
	<div id="costlyWillWindow" class="draggable ui-window oneDirectionalWindow hidden">
		<div class="anchor-group">
			<div class="anchor" data-id="FWwnd"> ðŸ“€ </div>

		</div>
		Cost of will
		Fridge
		Vacuum
	</div>

	<div id="fridgeWindow" class="draggable ui-window hidden">
		<div class="anchor-group">
			<div class="anchor" data-id="FWwnd"> ðŸ“€ </div>

		</div>
		Fridge
	</div>

	<div id="vacuumWindow" class="draggable ui-window hidden">
		<div class="anchor-group">
			<div class="anchor" data-id="FWwnd"> ðŸ“€ </div>

		</div>
		Vacuum
	</div>

	<div id="timeWindow" class="draggable ui-window oneDirectionalWindow hidden">

		<div class="anchor-up">
			<div class="anchor" data-id="timeWnd"> ðŸ’¿ </div>
		</div>
		TimeWindow
	</div>

	<div id="recipeWindow" class="draggable ui-window hidden">
		<div class="anchor-group">
			<div class="anchor" data-id="recipe-win-1"> ðŸ“€ </div>
		</div>
		<div class="anchor anchor-up" data-id="recipe-win-up-1"> ðŸ’¿ </div>
		<h1 style="margin-bottom:20px">My Recipes</h1>

		<div id="recipeList">
			<!-- Example recipe items. These would be generated dynamically. -->
			<div class="recipe-item">
				<span class="recipe-name">Scrambled Eggs & Ham</span>
				<span class="recipe-age">Created: 2 hours ago</span>
			</div>
			<div class="recipe-item">
				<span class="recipe-name">Protein Shake</span>
				<span class="recipe-age">Created: 1 day ago</span>
			</div>

			<div data-name="beef-recipe" class="recipe-item" onclick="document.querySelector('#recipeCreatorWindow').classList.remove('hidden');">
				<span class="recipe-name">Beef with Rice</span>
				<span class="recipe-age">Created: 1 hour ago</span>
			</div>
		</div>

		<button id="createNewRecipeBtn" style="margin-top: 20px;">+ Create New Recipe</button>
    </div>

	<div id="recipeCreatorWindow" class="draggable ui-window hidden">
        <div class="anchor-group">
            <div class="anchor" data-id="recipe-creator-win-1"> ðŸ“€ </div>
        </div>
        <div class="anchor anchor-up" data-id="recipe-creator-win-up-1"> ðŸ’¿ </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="margin-bottom:10px;">Ingredient Process - Beef with Rice</h1>
            <button class="subtle" style="width: 30%; margin: 0;" onclick="alert('No instructions defined')">Cooking Instructions</button>
        </div>

        <div class="ingredient-process-list">
            <!-- Ingredient Row 1: Simple -->
            <div class="ingredient-process-item">
                <span>Rice (Basmati)</span>
                <div class="ingredient-actions">
                    <button class="subtle" onclick="alert('No instructions for Rice')">Instructions</button>
                    <button class="subtle toggle-cook">Cook</button>
                    <button class="subtle">Skip</button>
                    <span class="ttl-display hidden">TTL: 48h</span>
                </div>
            </div>
			<!-- Ingredient Row 2: Simple -->
            <div class="ingredient-process-item">
                <span>Beef (15% fat)</span>
                <div class="ingredient-actions">
                    <button class="subtle" onclick="alert('No instructions for Beef')">Instructions</button>
                    <button class="subtle toggle-cook">Cook</button>
                    <button class="subtle">Skip</button>
                    <span class="ttl-display hidden">TTL: 48h</span>
                </div>
            </div>
            <!-- Ingredient Row 3: Sub-recipe -->
            <div class="ingredient-process-item">
                <span>Spice Mix</span>
                <div class="ingredient-actions">
                    <button class="subtle" onclick="alert('Opening sub-recipe...')">Open Sub-recipe</button>
                    <button class="subtle toggle-cook">Cook</button>
                    <button class="subtle">Skip</button>
                    <span class="ttl-display hidden">TTL: 48h</span>
                </div>
            </div>
            <!-- Ingredient Row 4: Unavailable -->
            <div class="ingredient-process-item not-available">
                <span>Mushrooms (not available)</span>
                <div class="ingredient-actions">
                    <button class="subtle" onclick="document.querySelector('#shoppingWindow').classList.remove('hidden');">Find Hunting Locations</button>
                </div>
            </div>
        </div>

		<div class="recipe-actions-footer">
            <div class="recipe-status">
                <span>Location: <strong id="recipeLocation">potential</strong></span>
                <span>Est. Remaining: <strong id="recipeRemaining">500g</strong></span>
            </div>
            <div class="recipe-consume">
                <label for="portionToEat">Portion to eat:</label>
                <input type="number" id="portionToEat" value="0.2" step="0.1" style="width: 60px; margin: 0 10px;">
                <button onclick="alert('Eating portion...')">Eat!</button>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
            <button style="width: 48%;" onclick="alert('Cooking all ingredients...')">Cook All</button>
            <button style="width: 48%;" onclick="alert('Store where?')">Store</button>
			
        </div>
    </div>


	<div id="historyWindowParent" class="draggable sidebar ui-window">
		<div class="anchor-group">
			<div class="anchor" data-id="win2"> ðŸ“€ </div>
			<div class="anchor" data-id="win3"> ðŸ“€ </div>
			<div class="anchor" data-id="win4"> ðŸ“€ </div>
		</div>
		<div class="anchor anchor-up" data-id="win2-up"> ðŸ’¿ </div>
		<h3 style="float:left">History</h3>
		<input type="checkbox" id="allHistoryChk" style="margin-left:40%; width:40px"
			onchange="window.MacroTracker.displayHistoryTable()">
		<label for="allHistoryChk">all history</label>
		<div id="historyWindow">
			<table id="historyEntries">
				<tbody>
					<tr>
						<th>#</th>
						<th>Date</th>
						<th>Carbs</th>
						<th>Protein</th>
						<th>Fat</th>
						<th>Note</th>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<div id="dayListOverviewParent" class="draggable sidebar ui-window hidden">
		<div class="anchor anchor-up" data-id="day-list-over"> ðŸ’¿ </div>
		<h3>Day overview</h3>

		<div id="dayListOverview">
			<!--
      Day one ...
      Day two ...
      Day three ...
      -->
		</div>
	</div>

	<div id="sumDigestionWindow" class="draggable sidebar ui-window hidden">
		<div class="anchor anchor-up" data-id="sum-digest-inup"> ðŸ’¿ </div>
		<h2>24 hour Window</h2>
		<div class="totals24">
			<div class="total-item">Calories (24h): <span id="t24calories">3086</span>kcal</div>
			<div class="total-item">Mass (24h): <span id="t24weight">693</span>g</div>

		</div>

		<h2>Today's Totals</h2>
		<div class="totals">

			<div class="total-item">Protein: <span id="totalProtein" class="halfway-there"></span>g</div>
			<div class="total-item">Carbs: <span id="totalCarbs" class=""></span>g</div>
			<div class="total-item">Fat: <span id="totalFat" class="goal-reached"></span>g</div>
			<div class="total-item">Calories: <span id="totalCalories" class="halfway-there"></span>kcal</div>
		

		</div>

	</div>

	<div id="shoppingWindow" class="draggable ui-window hidden">
        <div class="anchor-group">
            <div class="anchor" data-id="shopping-win-1"> ðŸ“€ </div>
        </div>
        <div class="anchor anchor-up" data-id="shopping-win-up-1"> ðŸ’¿ </div>
        <h1 style="margin-bottom:20px">Ingredient Commutor</h1>

        <label for="shoppingPurposeKey">Ingredient (PurposeKey)</label>
        <select id="shoppingPurposeKey" onchange="window.Shopper.handleIngredientSelection();">
            <!-- Options will be populated from ingredients.js -->
            <option value="" >Select Ingredient...</option>
        </select>

        <label for="ingredientVariant">Ingredient Variant</label>
		<button class="subtle" onclick="prompt('Variant key for new item template', '');">Branch</button>
        <select id="ingredientVariant" placeholder="e.g. 30% fat beef">
		</select>

		<label for="SourceAreaName">Source Area</label>
        <label for="shoppingPrice" style="float: right;">Price</label>
		<select style="float: left; width:73%;" id="SourceAreaName">
			<option value="" >Automatic (agnostic)</option>
			<option value="" >City center</option>
			<option value="" >City north</option>
			<option value="" >City south</option>
			<option value="" >City east</option>
			<option value="" >City west</option>
			
		</select>	
		<input type="number" id="shoppingPrice" style="float: right; width:23%;" value="1" placeholder="1.00">
		<div style="clear: both;"></div>
		<br/> 
        <label for="shoppingBuyPeriod">Window Size (days)</label>
        <input type="number" id="shoppingBuyPeriod" value="7" placeholder="e.g., 7 for weekly">

        <button class="subtle" onclick="window.Shopper.applyIngredientIntent('bought')">Pay</button>
		<button class="subtle" onclick="window.Shopper.applyIngredientIntent('trashed')">Surrender</button>
		<button class="subtle" onclick="window.Shopper.applyIngredientIntent('commited')">Demand</button>	
        
    </div>

    <div id="intentionsWindow" class="draggable ui-window hidden">
        <div class="anchor-group">
            <div class="anchor" data-id="intentions-win-1"> ðŸ“€ </div>
        </div>
        <h1>Intentions</h1>
        <p>Demanded ingredients and evaporated intents.</p>
        <div class="intentions-list">
            <div class="intention-item">
                <span>Mushrooms</span>
                <span class="intention-timer">Time to buy: <strong>2 days</strong></span>
            </div>
            <div class="intention-item">
                <span>Ground Beef (30% fat)</span>
                <span class="intention-timer">Time to buy: <strong>4 days</strong></span>
            </div>
        </div>
    </div>

    <div id="actionHistoryWindow" class="draggable ui-window hidden">
        <div class="anchor-group">
            <div class="anchor" data-id="action-history-win-1"> ðŸ“€ </div>
        </div>
        <h1>Action History</h1>
        <p>Log of bought ingredients and storage actions.</p>
        <div class="action-history-list">
            <div class="action-item">
                <span><strong>Bought:</strong> Chicken (1000g)</span>
                <span class="action-meta">Stored in: <strong>Fridge</strong> | 2 hours ago</span>
            </div>
            <div class="action-item">
                <span><strong>Bought:</strong> Rice (500g)</span>
                <span class="action-meta">Stored in: <strong>Pantry</strong> | 5 hours ago</span>
            </div>
        </div>
    </div>

    <div id="inventoryWindow" class="draggable ui-window hidden">
  
		<div class="header-group">
			<h1 style="margin-bottom:10px;">Fridge and Pantry</h1>

			<label for="storageUnitSelect">Storage Unit</label>
			<select id="storageUnitSelect">
				<option value="all">All</option>
				<option value="fridge">Fridge Only</option>
				<option value="pantry">Pantry Only</option>
			</select>
		</div>
      	<div class="anchor-group">
            <div class="anchor" data-id="inventory-win-1"> ðŸ“€ </div>
        </div>

        <div class="inventory-list">
            <!-- Item 1 -->
            <div class="inventory-item">
                <div class="item-header">
                    <h3>Meal #0</h3>
                    <div>
                        <button class="subtle" style="width:auto; padding: 5px 10px;">Reheat</button>
                        <button class="subtle" style="width:auto; padding: 5px 10px;">Cool</button>
                    </div>
                </div>
                <div class="item-details">
                    <span>Fresh TTL: <strong>48 hours</strong></span>
                    <span>Refrigerated: <strong>24 hours</strong></span>
                    <span>Room time: <strong>4 hours</strong></span>
                </div>
                <div class="portions-list">
                    <h4>Portions:</h4>
                    <div class="portion-item">
                        <span>Meat 50g</span>
                        <div>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Eat</button>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Trash</button>
                        </div>
                    </div>
                    <div class="portion-item">
                        <span>Meat 50g</span>
                        <div>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Eat</button>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Trash</button>
                        </div>
                    </div>
                    <div class="portion-item">
                        <span>Rice 100g</span>
                        <div>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Eat</button>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Trash</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Item 2 -->
            <div class="inventory-item">
                <div class="item-header">
                    <h3>Salad #1</h3>
                    <div>
                        <button class="subtle" style="width:auto; padding: 5px 10px;">Reheat</button>
                        <button class="subtle" style="width:auto; padding: 5px 10px;">Cool</button>
                    </div>
                </div>
                <div class="item-details">
                    <span>Fresh TTL: <strong>12 hours remaining</strong></span>
                    <span>Refrigerated: <strong>12 hours</strong></span>
                    <span>Room time: <strong>2 hours</strong></span>
                </div>
                <div class="portions-list">
                    <h4>Portions:</h4>
                    <div class="portion-item">
                        <span>Salad 30g</span>
                        <div>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Eat</button>
                            <button class="subtle" style="width:auto; padding: 2px 8px;">Trash</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<svg class="flow-canvas">
	</svg>


</body>

</html>